<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mon Planning</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/5.11.3/main.min.css">
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.15/index.global.min.js"></script>
    <script defer src="{{ url_for('static', filename='js/script.js') }}"></script>
    <style>
        /* Style général de la page */
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            margin: 0;
            padding: 0;
        }
        .page {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        .planning-container {
            display: flex;
            flex-direction: column;
            height: 90vh;
            padding: 20px;
        }

        h1 {
            margin-top: 20px;
            margin-bottom: 20px;
            margin-left: 10px;
            font-size: 3em;
        }

        /* Style des boutons */
        .actions {
            text-align: center;
            margin-top: 20px;
        }

        .btn {
            display: inline-block;
            padding: 10px 20px;
            margin: 5px;
            font-size: 16px;
            cursor: pointer;
            text-decoration: none;
            border-radius: 5px;
        }

        .btn-primary {
            background-color: #007bff;
            color: white;
            border: none;
        }

        .btn-secondary {
            background-color: #6c757d;
            color: white;
            border: none;
        }

        .fc-header-toolbar {
        /*
        the calendar will be butting up against the edges,
        but let's scoot in the header's buttons
        */
        padding-top: 1em;
        padding-left: 1em;
        padding-right: 1em;
        }

        /* Styles pour les fenêtres modales */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.25);
            
        }

        .modal-content {
            background-color: #b6c0d935;
            margin: 15% auto;
            padding: 20px;
            border: 1px solid #888;
            width: fit-content;
            border-radius: 5px;
            text-align: center;
            display: flex;
            flex-direction: column;
            flex-wrap: wrap;

        }
        .date {
            background-color: #CBE2FC;
            border-radius: 25px;
        }
        .event-card {
            display: flex;
            flex-direction: row;
            align-items: center;
            justify-content: space-around;
        }
        .event-section {
            background-color: #CBE2FC; 
            padding: 2.5vw; 
            margin: 10px;
            border-radius: 25px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            
        }
        .event-section h3 {
            font-size: 1.5em;
            margin: 0;
            padding: 10px;
        }
        .event-section input {
            width: auto;
            margin-left: 5px;
            padding: 5px;
            border-radius: 5px;
            border: 2px solid #CBE2FC;
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close:hover,
        .close:focus {
            color: black;
        }
        #date-input {
            width: auto;
            margin-left: 5px;
            padding: 5px;
            border-radius: 5px;
            border: 2px solid #CBE2FC;
        }
        
    </style>
</head>

<body>
    <div class="page">
        {% include 'includes/header.html' %}
        
        <main class="planning-container">
            <h1>Mon planning</h1>
            <div id="calendar"></div>
        </main>
    </div>

    <!-- Fenêtre modale pour la sélection de date -->
    <div id="date-modal" class="modal">
        <div class="modal-content date">
            <p>Sélectionnez une date :</p>
            <input type="date" id="date-input">
            <div style="display: flex; justify-content: end; gap:10px; margin-top: 15px;">
                <button class="btn btn-secondary" id="cancel-date-btn">Annuler</button>
                <button class="btn btn-primary" id="submit-date-btn">OK</button>
            </div>
        </div>
    </div>


    <!-- Popup pour ajouter un événement dans le calendrier -->
    <div id="event-modal" class="modal">
        <div class="modal-content">
            <div class="event-card">
                <!-- Section Début -->
                <div class="event-section">
                    <h3>Début</h3>
                    <label for="start-date">Date :</label>
                    <input type="date" id="start-date">
                    <label for="start-time">Heure :</label>
                    <input type="time" id="start-time">
                </div>
                <!-- Section Fin -->
                <div class="event-section">
                    <h3>Fin</h3>
                    <label for="end-date">Date :</label>
                    <input type="date" id="end-date">
                    <label for="end-time">Heure :</label>
                    <input type="time" id="end-time">
                </div>
            </div>
            <div style="display: flex; justify-content: end; gap:10px; margin-top: 15px;">
                <button class="btn btn-secondary" id="cancel-event-btn" onclick="">Annuler</button>
                <button class="btn btn-primary" id="submit-event-btn" onclick="">OK</button>
            </div>
        </div>
    </div>
    <div id="indisp-modal" class="modal">
        <div class="modal-content indisp-modal-cotent">
            <div class="event-card">
                <!-- Section Début -->
                <div class="event-section">
                    <h3>Début</h3>
                    <label for="start-date">Date :</label>
                    <input type="date" id="start-date">
                    <label for="start-time">Heure :</label>
                    <input type="time" id="start-time">
                </div>
                <!-- Section Fin -->
                <div class="event-section">
                    <h3>Fin</h3>
                    <label for="end-date">Date :</label>
                    <input type="date" id="end-date">
                    <label for="end-time">Heure :</label>
                    <input type="time" id="end-time">
                </div>
            </div>
            <div style="display: flex; justify-content: end; gap:10px; margin-top: 15px;">
                <button class="btn btn-secondary" id="cancel-indisp-event-btn">Annuler</button>
                <button class="btn btn-primary" id="submit-event-btn" onclick="">OK</button>
            </div>
        </div>
    </div>

    <script>
        
        document.addEventListener('DOMContentLoaded', () => {
            
                // Gestion de la fermeture des popups avec boutons annulez
                document.getElementById('cancel-indisp-event-btn').onclick = function() {
                    document.getElementById('indisp-modal').style.display = 'none';
                };
                document.getElementById('cancel-event-btn').onclick = function() {
                    document.getElementById('event-modal').style.display = 'none';
                };
                document.getElementById('cancel-date-btn').onclick = function() {
                    document.getElementById('date-modal').style.display = 'none';
                };

            // Initialisation du calendrier
            var calendarEl = document.getElementById('calendar');
            var calendar = new FullCalendar.Calendar(calendarEl, {
                initialView: 'dayGridMonth', // ou timeGridWeek
                headerToolbar: {
                    left: 'customButton',
                    center: 'title',
                    right: 'prev,next,timeGridWeek,dayGridMonth'
                },
                footerToolbar: {
                    left: 'ajouterdispbtn',
                    center: '',
                    right: 'ajouterindispbtn'
                },
                buttonText: {
                    today: 'Aujourd\'hui',
                    month: 'Mois',
                    week: 'Semaine'
                },
                customButtons: {
                    customButton: {
                        text: 'Mon Planning',
                        click: function() {
                            document.getElementById('date-modal').style.display = 'block';
                        }
                    },
                    ajouterdispbtn: {
                        text: 'Ajouter disp.',
                        click: function() {
                            document.getElementById('event-modal').style.display = 'block';
                        }
                    },
                    ajouterindispbtn: {
                        text: 'Ajouter indisp.',
                        click: function() {
                            document.getElementById('indisp-modal').style.display = 'block';
                        },
                        className: 'btn-red' // Ajout de la classe pour la couleur rouge
                    }
                },
                locale: 'fr',
                timeZone: 'Europe/Paris',
                expandRows: true,
                dayMaxEvents: true,
                slotMinTime: "00:00:00",
                slotMaxTime: "24:00:00",
                allDaySlot: false
            });
            calendar.render();
            calendar.setOption('height', window.innerHeight - 120);
            calendar.setOption('contentHeight', window.innerHeight - 120);

            // Le reste de votre gestion des modales et interactions...

            // Gestion de la fenêtre modale pour la date
            var dateModal = document.getElementById('date-modal');
            var gotoDateBtn = document.getElementById('goto-date-btn');
            var submitDateBtn = document.getElementById('submit-date-btn');
            var dateInput = document.getElementById('date-input');

            gotoDateBtn.onclick = function() {
                dateModal.style.display = 'block';
            };

            submitDateBtn.onclick = function() {
                var selectedDate = dateInput.value;
                if (selectedDate) {
                    calendar.gotoDate(selectedDate);
                    dateModal.style.display = 'none';
                } else {
                    alert('Veuillez sélectionner une date.');
                }
            };

            // Popup : ajout d'un événement
            document.getElementById('submit-event-btn').onclick = function() {
                // Récupération des valeurs
                var startDate = document.getElementById('start-date').value;
                var startTime = document.getElementById('start-time').value;
                var endDate = document.getElementById('end-date').value;
                var endTime = document.getElementById('end-time').value;
                
                // Contrôle que tous les champs sont renseignés
                if (!startDate || !startTime || !endDate || !endTime) {
                    alert("Veuillez renseigner toutes les informations.");
                    return;
                }
                
                // Construction des objets Date pour comparaison
                var startDateTime = new Date(startDate + 'T' + startTime);
                var endDateTime = new Date(endDate + 'T' + endTime);
                
                if (endDateTime <= startDateTime) {
                    alert("La date/heure de fin doit être postérieure à celle de début.");
                    return;
                }
                
                // Création d'un dictionnaire pour l'événement
                var newEvent = {
                    start: startDateTime.toISOString(),
                    end: endDateTime.toISOString()
                };
                
                // Ici vous pouvez ajouter l'événement au calendrier ou l'utiliser 
                // par la suite, par exemple :
                console.log("Nouvel événement :", newEvent);
                alert("Événement ajouté !");
                
                // Ferme la popup
                document.getElementById('event-modal').style.display = 'none';
            };

            // Gestion du bouton "Annuler" pour l'événement
            document.getElementById('cancel-event-btn').onclick = function() {
                document.getElementById('event-modal').style.display = 'none';
            };

            // Gestion de la fermeture des popups avec la croix
            var closeButtons = document.querySelectorAll('.modal .close');
            closeButtons.forEach(function(btn) {
                btn.onclick = function() {
                    // Utilisation de closest pour récupérer l'élément modal le plus proche
                    var modal = btn.closest('.modal');
                    if (modal) {
                        modal.style.display = 'none';
                    }
                };
            });
            
        });
    </script>
</body>
</html>